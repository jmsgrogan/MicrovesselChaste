<!DOCTYPE html>
<html>
  <head>

    <title>Test Build Vessel Network Tutorial | Microvessel Chaste</title>
    
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

      <!--<link rel="icon" type="image/png" href="https://jmsgrogan.github.io/MicrovesselChaste/resources/favicon.ico">-->
      <!--<link rel="shortcut icon" type="image/png" href="https://jmsgrogan.github.io/MicrovesselChaste/resources/favicon.ico">-->

    <!-- prettify CSS (corresponding js at footer)-->
    <link rel="stylesheet" href="https://jmsgrogan.github.io/MicrovesselChaste/resources/css/prettify.css" type="text/css" />

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://jmsgrogan.github.io/MicrovesselChaste/resources/css/bootstrap.css" type="text/css" />

    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600,700,900,400italic,700italic' rel='stylesheet' type='text/css'>

    <!-- Custom stylesheet -->
    <link rel="stylesheet" href="https://jmsgrogan.github.io/MicrovesselChaste/resources/css/main.css" type="text/css" />

    <!-- Typekit (should stay at top of page, do not move to footer)-->
    <script type="text/javascript" src="//use.typekit.net/abh3wgk.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>

    <!-- Atom feeds -->
    <link rel="alternate" type="application/atom+xml" title="News Feed" href="https://jmsgrogan.github.io/MicrovesselChaste/feed/index.xml" />
    <link rel="alternate" type="application/atom+xml" title="Blog Feed" href="https://jmsgrogan.github.io/MicrovesselChaste/feed/blog.xml" />


  </head>
  <body>


<div class="darkstrip"></div>

<div class="darkbluetopbar">
  <div class="container" style="height: 100%">
    <div class="navbar-wrap">
      <div class="container" style="position: relative; height: 100%;">
        <div class="scala-logo">
          <a href="https://jmsgrogan.github.io/MicrovesselChaste/index.html"><img src="https://jmsgrogan.github.io/MicrovesselChaste/resources/img/mvc_logo_25.png" alt="Microvessel Chaste Logo" />
        </div>
        <ul class="nav">
  <li><a href="https://jmsgrogan.github.io/MicrovesselChaste/documentation/">Documentation</a></li>
  <li><a href="https://jmsgrogan.github.io/MicrovesselChaste/documentation/installation.html">Download</a></li>
  <li><a href="https://jmsgrogan.github.io/MicrovesselChaste/community/">Community</a></li>
  <li><a href="https://jmsgrogan.github.io/MicrovesselChaste/contribute/">Contribute</a></li>
  <li id="source-code" >
    <a href="https://github.com/jmsgrogan/MicrovesselChaste"><img src="https://jmsgrogan.github.io/MicrovesselChaste/resources/img/github-logo.png" alt="GitHub Logo" /></a>
    <div class="toptip">Source Code</div>
  </li>
  <li id="scala-lang-twitter">
    <a href="https://twitter.com/chaste_project"><img src="https://jmsgrogan.github.io/MicrovesselChaste/resources/img/twitter-logo-white.png" alt="Twitter Logo" /></a>
    <div class="toptip">Chaste on Twitter</div>
  </li>
</ul>

      </div>
    </div>
  </div>
</div>

<div class="midbluebar">
  <div class="container">
    <h1 id="page-title">Test Build Vessel Network Tutorial</h1>
  </div>
</div>

<div class="page-container">
  <div class="container" style="min-height: 540px;">
    <div class="row">
      <div class="span12">
          <div class="main-page-column" style="width: 100%;">
            
            <p>This tutorial is automatically generated from the file test/tutorials//TestBuildVesselNetworkTutorial.hpp.
Note that the code is given in full at the bottom of the page.</p>

<h1>Building A Vessel Network Tutorial</h1>

<p>This tutorial is designed to introduce the C++ interface for modelling vessel networks.</p>

<p>The following is covered:
 * Manually building a network from a collection of nodes, segments and vessels
 * Managing dimensions and units
 * Reading, writing and visualizing vessel networks
 * Vessel network generators</p>

<h1>The Test</h1>

<p>Start by introducing the necessary header files. The first contain functionality for setting up unit tests.</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="cp">#include &lt;cxxtest/TestSuite.h&gt;
#include "AbstractCellBasedWithTimingsTestSuite.hpp"
</span></code></pre></div>
<p>Boost shared pointers are used extensively in this component. This header contains some useful
pointer MACROs.</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="cp">#include "SmartPointers.hpp"
</span></code></pre></div>
<p>The <code>OutputFileHandler</code> manages where output files are written to.</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="cp">#include "OutputFileHandler.hpp"
</span></code></pre></div>
<p>These headers contain the building-blocks of the vessel networks; nodes, segments, vessels and the network itself.</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="cp">#include "VesselNode.hpp"
#include "VesselSegment.hpp"
#include "Vessel.hpp"
#include "VesselNetwork.hpp"
</span></code></pre></div>
<p>Tools for reading and writing networks.</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="cp">#include "VesselNetworkReader.hpp"
#include "VesselNetworkWriter.hpp"
</span></code></pre></div>
<p>Dimensional analysis.</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="cp">#include "DimensionalChastePoint.hpp"
#include "UnitCollection.hpp"
#include "BaseUnits.hpp"
</span></code></pre></div>
<p>Tools for automatically generating vessel networks</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="cp">#include "VesselNetworkGenerator.hpp"
</span></code></pre></div>
<p>Visualization</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="cp">#include "MicrovesselVtkScene.hpp"
</span></code></pre></div>
<p>Used to initialize MPI/PETSc in unit tests.</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="cp">#include "PetscSetupAndFinalize.hpp"
</span></code></pre></div>
<p>Tutorials are developed as a series of unit tests using the <code>CxxTest</code> framework. Make a single test class, which inherits from
<code>AbstractCellBasedWithTimingsTestSuite</code>. <code>AbstractCellBasedWithTimingsTestSuite</code> adds some useful functionality to the default
<code>CxxTest::TestSuite</code> class, including setting up timers and initializing random number generators.</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">TestBuildVesselNetworkLiteratePaper</span> <span class="o">:</span> <span class="k">public</span> <span class="n">AbstractCellBasedWithTimingsTestSuite</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
</code></pre></div>
<h2>Test 1 - Building a vessel network manually, writing it to file and visualizing it</h2>

<p>In the first test build a vessel network from its constituent components; nodes, segments and vessels. Do some
simple tests to make sure the network has been formed as expected. Then write the network to file and visualize it in Paraview. The
network will be built manually, which is tedious and not done much in practice. Later examples will used automatic generators.</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp">    <span class="kt">void</span> <span class="nf">TestBuildNetworkManually</span><span class="p">()</span> <span class="k">throw</span> <span class="p">(</span><span class="n">Exception</span><span class="p">)</span>
    <span class="p">{</span>
</code></pre></div>
<p>First, a note on units. In many simulations with vessel networks care is needed in managing units, as multiple computational grids and
physical phenomena are of interest. It is helpful to be explicit regarding assumed length, time and mass scales and to specify input parameters
with accompanying units. In this component, the <code>DimensionalChastePoint</code> is a fundamental geometric feature which contains a location in <code>N</code>
dimensional space, stored as a vector of dimensionless doubles, and an accompanying reference length. Thus, each <code>DimensionalChastePoint</code> is a
location with units. To demonstrate, we will create a point, which has a reference length of 1 micron and then re-scale its location according
to a different reference length, a cell width. Note that the syntax <code>reference_length(1.0 * unit::microns)</code> rather than
<code>reference_length = 1.0 * unit::microns</code> is used when instantiating quantities.</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp">        <span class="n">units</span><span class="o">::</span><span class="n">quantity</span><span class="o">&lt;</span><span class="n">unit</span><span class="o">::</span><span class="n">length</span><span class="o">&gt;</span> <span class="n">reference_length</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">unit</span><span class="o">::</span><span class="n">microns</span><span class="p">);</span>
        <span class="n">DimensionalChastePoint</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="n">my_point</span><span class="p">(</span><span class="mf">25.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">reference_length</span><span class="p">);</span>
</code></pre></div>
<p>We can use the unit test framework to check our coordinate values are assigned as expected.</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp">        <span class="n">TS_ASSERT_DELTA</span><span class="p">(</span><span class="n">my_point</span><span class="p">.</span><span class="n">GetLocation</span><span class="p">(</span><span class="n">reference_length</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">25.0</span><span class="p">,</span> <span class="mf">1.e-6</span><span class="p">);</span>
        <span class="n">TS_ASSERT_DELTA</span><span class="p">(</span><span class="n">my_point</span><span class="p">.</span><span class="n">GetLocation</span><span class="p">(</span><span class="n">reference_length</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mf">1.e-6</span><span class="p">);</span>
</code></pre></div>
<p>If we want our coordinates in terms of a fictitious cell width unit we just have to rescale the reference length.</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp">        <span class="n">units</span><span class="o">::</span><span class="n">quantity</span><span class="o">&lt;</span><span class="n">unit</span><span class="o">::</span><span class="n">length</span><span class="o">&gt;</span> <span class="n">cell_width</span><span class="p">(</span><span class="mf">25.0</span> <span class="o">*</span> <span class="n">unit</span><span class="o">::</span><span class="n">microns</span><span class="p">);</span>
        <span class="n">my_point</span><span class="p">.</span><span class="n">SetReferenceLengthScale</span><span class="p">(</span><span class="n">cell_width</span><span class="p">);</span>
        <span class="n">TS_ASSERT_DELTA</span><span class="p">(</span><span class="n">my_point</span><span class="p">.</span><span class="n">GetLocation</span><span class="p">(</span><span class="n">cell_width</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.e-6</span><span class="p">);</span>
        <span class="n">TS_ASSERT_DELTA</span><span class="p">(</span><span class="n">my_point</span><span class="p">.</span><span class="n">GetLocation</span><span class="p">(</span><span class="n">cell_width</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.e-6</span><span class="p">);</span>
</code></pre></div>
<p>It is tedious to keep supplying a reference length, mass, time when setting up simulations. To avoid this a <code>BaseUnits</code> singleton is
used to set these values. Any geometrical features, readers, writers, solvers etc. created after a base unit has been set will take
the current value as their <code>ReferenceXScale</code>. As will be demonstrated, these values can be over-ridden on a class-by-class basis
if needed.</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp">        <span class="n">BaseUnits</span><span class="o">::</span><span class="n">Instance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">SetReferenceLengthScale</span><span class="p">(</span><span class="n">reference_length</span><span class="p">);</span>
        <span class="n">BaseUnits</span><span class="o">::</span><span class="n">Instance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">SetReferenceTimeScale</span><span class="p">(</span><span class="mf">60.0</span> <span class="o">*</span> <span class="n">unit</span><span class="o">::</span><span class="n">seconds</span><span class="p">);</span>
</code></pre></div>
<p>All geometric features, <code>VesselNodes</code>, <code>Parts</code>, <code>RegularGrids</code> use the <code>DimensionalChastePoint</code> as their base representation of spatial
location, meaning that it is straight-forward to change or even mix length scales in a simulation.</p>

<p>Now we proceed to making some nodes, which are point features from which vessels can be constructed. They are initialized in the same way as
a <code>DimensionalChastePoint</code>, but use a convenience <code>Create</code> factory method to get a shared pointer. We will create a 2D Y shaped network.
Again, we will avoid the tedium of manual network creation in later examples.</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp">        <span class="kt">double</span> <span class="n">vessel_length</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">VesselNode</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_node_1</span> <span class="o">=</span> <span class="n">VesselNode</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;::</span><span class="n">Create</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">VesselNode</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_node_2</span> <span class="o">=</span> <span class="n">VesselNode</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;::</span><span class="n">Create</span><span class="p">(</span><span class="n">vessel_length</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">reference_length</span><span class="p">);</span>
        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">VesselNode</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_node_3</span> <span class="o">=</span> <span class="n">VesselNode</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;::</span><span class="n">Create</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">vessel_length</span><span class="p">,</span> <span class="n">vessel_length</span><span class="p">);</span>
        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">VesselNode</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_node_4</span> <span class="o">=</span> <span class="n">VesselNode</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;::</span><span class="n">Create</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">vessel_length</span><span class="p">,</span> <span class="o">-</span><span class="n">vessel_length</span><span class="p">);</span>
</code></pre></div>
<p>Next make vessel segments and vessels. Vessel segments are straight-line features which contain a <code>VesselNode</code> at each end. Vessels
can be constructed from multiple vessel segments by adding them in order, but in this case each vessel just has a single segment.</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp">        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">VesselSegment</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_segment_1</span> <span class="o">=</span> <span class="n">VesselSegment</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;::</span><span class="n">Create</span><span class="p">(</span><span class="n">p_node_1</span><span class="p">,</span> <span class="n">p_node_2</span><span class="p">);</span>
        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Vessel</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_vessel_1</span> <span class="o">=</span> <span class="n">Vessel</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;::</span><span class="n">Create</span><span class="p">(</span><span class="n">p_segment_1</span><span class="p">);</span>
        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">VesselSegment</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_segment_2</span> <span class="o">=</span> <span class="n">VesselSegment</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;::</span><span class="n">Create</span><span class="p">(</span><span class="n">p_node_2</span><span class="p">,</span> <span class="n">p_node_3</span><span class="p">);</span>
        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Vessel</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_vessel_2</span> <span class="o">=</span> <span class="n">Vessel</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;::</span><span class="n">Create</span><span class="p">(</span><span class="n">p_segment_2</span><span class="p">);</span>
        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">VesselSegment</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_segment_3</span> <span class="o">=</span> <span class="n">VesselSegment</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;::</span><span class="n">Create</span><span class="p">(</span><span class="n">p_node_2</span><span class="p">,</span> <span class="n">p_node_4</span><span class="p">);</span>
        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Vessel</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_vessel_3</span> <span class="o">=</span> <span class="n">Vessel</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;::</span><span class="n">Create</span><span class="p">(</span><span class="n">p_segment_3</span><span class="p">);</span>
</code></pre></div>
<p>Now add the vessels to a vessel network.</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp">        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">VesselNetwork</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_network</span> <span class="o">=</span> <span class="n">VesselNetwork</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;::</span><span class="n">Create</span><span class="p">();</span>
        <span class="n">p_network</span><span class="o">-&gt;</span><span class="n">AddVessel</span><span class="p">(</span><span class="n">p_vessel_1</span><span class="p">);</span>
        <span class="n">p_network</span><span class="o">-&gt;</span><span class="n">AddVessel</span><span class="p">(</span><span class="n">p_vessel_2</span><span class="p">);</span>
        <span class="n">p_network</span><span class="o">-&gt;</span><span class="n">AddVessel</span><span class="p">(</span><span class="n">p_vessel_3</span><span class="p">);</span>
</code></pre></div>
<p>Use the test framework to make sure that the network has been created correctly by checking the number of vessels and nodes</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp">        <span class="n">TS_ASSERT_EQUALS</span><span class="p">(</span><span class="n">p_network</span><span class="o">-&gt;</span><span class="n">GetNumberOfNodes</span><span class="p">(),</span> <span class="mi">4u</span><span class="p">);</span>
        <span class="n">TS_ASSERT_EQUALS</span><span class="p">(</span><span class="n">p_network</span><span class="o">-&gt;</span><span class="n">GetNumberOfVessels</span><span class="p">(),</span> <span class="mi">3u</span><span class="p">);</span>
</code></pre></div>
<p>Next write the network to file. Use the <code>OutputFileHandler</code> functionality to manage the output location
and the pointer MACRO <code>MAKE_PTR_ARGS</code> to easily make a smart pointer. Networks are written using VTK&#39;s !PolyData format by default,
which will have a .vtp extension.</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp">        <span class="n">MAKE_PTR_ARGS</span><span class="p">(</span><span class="n">OutputFileHandler</span><span class="p">,</span> <span class="n">p_handler</span><span class="p">,</span> <span class="p">(</span><span class="s">"TestBuildVesselNetworkLiteratePaper"</span><span class="p">));</span>
        <span class="n">VesselNetworkWriter</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="n">writer</span><span class="p">;</span>
        <span class="n">writer</span><span class="p">.</span><span class="n">SetFileName</span><span class="p">(</span><span class="n">p_handler</span><span class="o">-&gt;</span><span class="n">GetOutputDirectoryFullPath</span><span class="p">()</span> <span class="o">+</span> <span class="s">"bifurcating_network.vtp"</span><span class="p">);</span>
        <span class="n">writer</span><span class="p">.</span><span class="n">SetVesselNetwork</span><span class="p">(</span><span class="n">p_network</span><span class="p">);</span>
        <span class="n">writer</span><span class="p">.</span><span class="n">Write</span><span class="p">();</span>
</code></pre></div>
<p>We can also view the network</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp">        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">MicrovesselVtkScene</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_scene</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">MicrovesselVtkScene</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">MicrovesselVtkScene</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="p">);</span>
        <span class="n">p_scene</span><span class="o">-&gt;</span><span class="n">SetVesselNetwork</span><span class="p">(</span><span class="n">p_network</span><span class="p">);</span>
        <span class="n">p_scene</span><span class="o">-&gt;</span><span class="n">SetSaveAsImages</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
        <span class="n">p_scene</span><span class="o">-&gt;</span><span class="n">SetOutputFilePath</span><span class="p">(</span><span class="n">p_handler</span><span class="o">-&gt;</span><span class="n">GetOutputDirectoryFullPath</span><span class="p">()</span> <span class="o">+</span> <span class="s">"network"</span><span class="p">);</span>
        <span class="n">p_scene</span><span class="o">-&gt;</span><span class="n">Start</span><span class="p">();</span>
        <span class="n">BaseUnits</span><span class="o">::</span><span class="n">Instance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">Destroy</span><span class="p">();</span>
    <span class="p">}</span>
</code></pre></div>
<p>Now we can visualize then network in Paraview. To view the network import the file
<code>TestBuildVesselNetworkLiteratePaper\bifurcating_network.vtp</code> into Paraview. For a nicer rendering you can do <code>Filters-&gt;Alphabetical-&gt;Tube</code>.</p>

<h1>Test 2 - Building a vessel network using a generator and reading from file</h1>

<p>It is usually tedious to build a vessel network from scratch. In this test we use a generator to automatically construct a network.
We then write it to file, read it back in and check that it is restored as expected.</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp">    <span class="kt">void</span> <span class="nf">TestBuildNetworkFromGeneratorAndReadFromFile</span><span class="p">()</span> <span class="k">throw</span> <span class="p">(</span><span class="n">Exception</span><span class="p">)</span>
    <span class="p">{</span>
</code></pre></div>
<p>Create a hexagonal network in 3D space using a generator. Specify the target network width and height and the desired vessel
length. The use of dimensional analysis is demonstrated by now using a fictitious &#39;cell width&#39; reference length unit instead of microns.</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp">        <span class="n">units</span><span class="o">::</span><span class="n">quantity</span><span class="o">&lt;</span><span class="n">unit</span><span class="o">::</span><span class="n">length</span><span class="o">&gt;</span> <span class="n">cell_width</span><span class="p">(</span><span class="mf">25.0</span> <span class="o">*</span> <span class="n">unit</span><span class="o">::</span><span class="n">microns</span><span class="p">);</span>
        <span class="n">BaseUnits</span><span class="o">::</span><span class="n">Instance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">SetReferenceLengthScale</span><span class="p">(</span><span class="n">cell_width</span><span class="p">);</span>
        <span class="n">BaseUnits</span><span class="o">::</span><span class="n">Instance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">SetReferenceTimeScale</span><span class="p">(</span><span class="mf">60.0</span> <span class="o">*</span> <span class="n">unit</span><span class="o">::</span><span class="n">seconds</span><span class="p">);</span>
        <span class="n">units</span><span class="o">::</span><span class="n">quantity</span><span class="o">&lt;</span><span class="n">unit</span><span class="o">::</span><span class="n">length</span><span class="o">&gt;</span> <span class="n">target_width</span> <span class="o">=</span> <span class="mf">60.0</span> <span class="o">*</span> <span class="n">cell_width</span><span class="p">;</span>
        <span class="n">units</span><span class="o">::</span><span class="n">quantity</span><span class="o">&lt;</span><span class="n">unit</span><span class="o">::</span><span class="n">length</span><span class="o">&gt;</span> <span class="n">target_height</span> <span class="o">=</span> <span class="mf">30.0</span> <span class="o">*</span> <span class="n">cell_width</span><span class="p">;</span>
        <span class="n">units</span><span class="o">::</span><span class="n">quantity</span><span class="o">&lt;</span><span class="n">unit</span><span class="o">::</span><span class="n">length</span><span class="o">&gt;</span> <span class="n">vessel_length</span> <span class="o">=</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">cell_width</span><span class="p">;</span>
</code></pre></div>
<p>Note that the generator is given the reference length scale. This is not imperative, but helps to ensure that all point coordinates
are stored with the same reference length scale. This is helpful when combining with computational grids and cell populations later on.</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp">        <span class="n">VesselNetworkGenerator</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span> <span class="n">network_generator</span><span class="p">;</span>
        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">VesselNetwork</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_network</span> <span class="o">=</span> <span class="n">network_generator</span><span class="p">.</span><span class="n">GenerateHexagonalNetwork</span><span class="p">(</span><span class="n">target_width</span><span class="p">,</span>
                                                                                                    <span class="n">target_height</span><span class="p">,</span>
                                                                                                    <span class="n">vessel_length</span><span class="p">);</span>
</code></pre></div>
<p>Get the number of nodes and vessels for testing later, and write the network to file as before. We want to over-ride the
reference length scale so that the output is written in micron. We could also change the &#39;ReferenceLengthScale&#39; in &#39;BaseUnits&#39;
if we wanted.</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp">        <span class="kt">unsigned</span> <span class="n">number_of_nodes</span> <span class="o">=</span> <span class="n">p_network</span><span class="o">-&gt;</span><span class="n">GetNumberOfNodes</span><span class="p">();</span>
        <span class="kt">unsigned</span> <span class="n">number_of_vessels</span> <span class="o">=</span> <span class="n">p_network</span><span class="o">-&gt;</span><span class="n">GetNumberOfVessels</span><span class="p">();</span>
        <span class="n">MAKE_PTR_ARGS</span><span class="p">(</span><span class="n">OutputFileHandler</span><span class="p">,</span> <span class="n">p_handler</span><span class="p">,</span> <span class="p">(</span><span class="s">"TestBuildVesselNetworkLiteratePaper"</span><span class="p">,</span> <span class="nb">false</span><span class="p">));</span>
        <span class="n">VesselNetworkWriter</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span> <span class="n">writer</span><span class="p">;</span>
        <span class="n">writer</span><span class="p">.</span><span class="n">SetFileName</span><span class="p">(</span><span class="n">p_handler</span><span class="o">-&gt;</span><span class="n">GetOutputDirectoryFullPath</span><span class="p">()</span> <span class="o">+</span> <span class="s">"hexagonal_network.vtp"</span><span class="p">);</span>
        <span class="n">writer</span><span class="p">.</span><span class="n">SetVesselNetwork</span><span class="p">(</span><span class="n">p_network</span><span class="p">);</span>
        <span class="n">units</span><span class="o">::</span><span class="n">quantity</span><span class="o">&lt;</span><span class="n">unit</span><span class="o">::</span><span class="n">length</span><span class="o">&gt;</span> <span class="n">micron_length_scale</span><span class="p">(</span><span class="mf">1.0</span><span class="o">*</span><span class="n">unit</span><span class="o">::</span><span class="n">microns</span><span class="p">);</span>
        <span class="n">writer</span><span class="p">.</span><span class="n">SetReferenceLengthScale</span><span class="p">(</span><span class="n">micron_length_scale</span><span class="p">);</span>
        <span class="n">writer</span><span class="p">.</span><span class="n">Write</span><span class="p">();</span>
</code></pre></div>
<p>Use a reader to read the network back in from the VTK file. Our network was written in units of micron, so
we need to tell the reader this so that locations are suitably stored.</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp">        <span class="n">VesselNetworkReader</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span> <span class="n">network_reader</span><span class="p">;</span>
        <span class="n">network_reader</span><span class="p">.</span><span class="n">SetReferenceLengthScale</span><span class="p">(</span><span class="n">micron_length_scale</span><span class="p">);</span>
        <span class="n">network_reader</span><span class="p">.</span><span class="n">SetFileName</span><span class="p">(</span><span class="n">p_handler</span><span class="o">-&gt;</span><span class="n">GetOutputDirectoryFullPath</span><span class="p">()</span> <span class="o">+</span> <span class="s">"hexagonal_network.vtp"</span><span class="p">);</span>
        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">VesselNetwork</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_network_from_file</span> <span class="o">=</span> <span class="n">network_reader</span><span class="p">.</span><span class="n">Read</span><span class="p">();</span>
</code></pre></div>
<p>We can also view the network</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp">        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">MicrovesselVtkScene</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_scene</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">MicrovesselVtkScene</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span> <span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">MicrovesselVtkScene</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span><span class="p">);</span>
        <span class="n">p_scene</span><span class="o">-&gt;</span><span class="n">SetVesselNetwork</span><span class="p">(</span><span class="n">p_network_from_file</span><span class="p">);</span>
        <span class="n">p_scene</span><span class="o">-&gt;</span><span class="n">SetSaveAsImages</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
        <span class="n">p_scene</span><span class="o">-&gt;</span><span class="n">SetOutputFilePath</span><span class="p">(</span><span class="n">p_handler</span><span class="o">-&gt;</span><span class="n">GetOutputDirectoryFullPath</span><span class="p">()</span> <span class="o">+</span> <span class="s">"hexagonal_network"</span><span class="p">);</span>
        <span class="n">p_scene</span><span class="o">-&gt;</span><span class="n">Start</span><span class="p">();</span>
</code></pre></div>
<p>Finally we check that the network has been correctly read back in using our unit test framework</p>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp">        <span class="n">TS_ASSERT_EQUALS</span><span class="p">(</span><span class="n">p_network_from_file</span><span class="o">-&gt;</span><span class="n">GetNumberOfNodes</span><span class="p">(),</span> <span class="n">number_of_nodes</span><span class="p">);</span>
        <span class="n">TS_ASSERT_EQUALS</span><span class="p">(</span><span class="n">p_network_from_file</span><span class="o">-&gt;</span><span class="n">GetNumberOfVessels</span><span class="p">(),</span> <span class="n">number_of_vessels</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<h1>Code</h1>

<p>The full code is given below</p>

<h2>File name <code>TestBuildVesselNetworkTutorial.hpp</code></h2>
<div class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="cp">#include &lt;cxxtest/TestSuite.h&gt;
#include "AbstractCellBasedWithTimingsTestSuite.hpp"
#include "SmartPointers.hpp"
#include "OutputFileHandler.hpp"
#include "VesselNode.hpp"
#include "VesselSegment.hpp"
#include "Vessel.hpp"
#include "VesselNetwork.hpp"
#include "VesselNetworkReader.hpp"
#include "VesselNetworkWriter.hpp"
#include "DimensionalChastePoint.hpp"
#include "UnitCollection.hpp"
#include "BaseUnits.hpp"
#include "VesselNetworkGenerator.hpp"
#include "MicrovesselVtkScene.hpp"
#include "PetscSetupAndFinalize.hpp"
</span><span class="k">class</span> <span class="nc">TestBuildVesselNetworkLiteratePaper</span> <span class="o">:</span> <span class="k">public</span> <span class="n">AbstractCellBasedWithTimingsTestSuite</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="kt">void</span> <span class="n">TestBuildNetworkManually</span><span class="p">()</span> <span class="k">throw</span> <span class="p">(</span><span class="n">Exception</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">units</span><span class="o">::</span><span class="n">quantity</span><span class="o">&lt;</span><span class="n">unit</span><span class="o">::</span><span class="n">length</span><span class="o">&gt;</span> <span class="n">reference_length</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">unit</span><span class="o">::</span><span class="n">microns</span><span class="p">);</span>
        <span class="n">DimensionalChastePoint</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="n">my_point</span><span class="p">(</span><span class="mf">25.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">reference_length</span><span class="p">);</span>
        <span class="n">TS_ASSERT_DELTA</span><span class="p">(</span><span class="n">my_point</span><span class="p">.</span><span class="n">GetLocation</span><span class="p">(</span><span class="n">reference_length</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">25.0</span><span class="p">,</span> <span class="mf">1.e-6</span><span class="p">);</span>
        <span class="n">TS_ASSERT_DELTA</span><span class="p">(</span><span class="n">my_point</span><span class="p">.</span><span class="n">GetLocation</span><span class="p">(</span><span class="n">reference_length</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mf">1.e-6</span><span class="p">);</span>
        <span class="n">units</span><span class="o">::</span><span class="n">quantity</span><span class="o">&lt;</span><span class="n">unit</span><span class="o">::</span><span class="n">length</span><span class="o">&gt;</span> <span class="n">cell_width</span><span class="p">(</span><span class="mf">25.0</span> <span class="o">*</span> <span class="n">unit</span><span class="o">::</span><span class="n">microns</span><span class="p">);</span>
        <span class="n">my_point</span><span class="p">.</span><span class="n">SetReferenceLengthScale</span><span class="p">(</span><span class="n">cell_width</span><span class="p">);</span>
        <span class="n">TS_ASSERT_DELTA</span><span class="p">(</span><span class="n">my_point</span><span class="p">.</span><span class="n">GetLocation</span><span class="p">(</span><span class="n">cell_width</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.e-6</span><span class="p">);</span>
        <span class="n">TS_ASSERT_DELTA</span><span class="p">(</span><span class="n">my_point</span><span class="p">.</span><span class="n">GetLocation</span><span class="p">(</span><span class="n">cell_width</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.e-6</span><span class="p">);</span>
        <span class="n">BaseUnits</span><span class="o">::</span><span class="n">Instance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">SetReferenceLengthScale</span><span class="p">(</span><span class="n">reference_length</span><span class="p">);</span>
        <span class="n">BaseUnits</span><span class="o">::</span><span class="n">Instance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">SetReferenceTimeScale</span><span class="p">(</span><span class="mf">60.0</span> <span class="o">*</span> <span class="n">unit</span><span class="o">::</span><span class="n">seconds</span><span class="p">);</span>
        <span class="kt">double</span> <span class="n">vessel_length</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">VesselNode</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_node_1</span> <span class="o">=</span> <span class="n">VesselNode</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;::</span><span class="n">Create</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">VesselNode</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_node_2</span> <span class="o">=</span> <span class="n">VesselNode</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;::</span><span class="n">Create</span><span class="p">(</span><span class="n">vessel_length</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">reference_length</span><span class="p">);</span>
        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">VesselNode</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_node_3</span> <span class="o">=</span> <span class="n">VesselNode</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;::</span><span class="n">Create</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">vessel_length</span><span class="p">,</span> <span class="n">vessel_length</span><span class="p">);</span>
        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">VesselNode</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_node_4</span> <span class="o">=</span> <span class="n">VesselNode</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;::</span><span class="n">Create</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">vessel_length</span><span class="p">,</span> <span class="o">-</span><span class="n">vessel_length</span><span class="p">);</span>
        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">VesselSegment</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_segment_1</span> <span class="o">=</span> <span class="n">VesselSegment</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;::</span><span class="n">Create</span><span class="p">(</span><span class="n">p_node_1</span><span class="p">,</span> <span class="n">p_node_2</span><span class="p">);</span>
        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Vessel</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_vessel_1</span> <span class="o">=</span> <span class="n">Vessel</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;::</span><span class="n">Create</span><span class="p">(</span><span class="n">p_segment_1</span><span class="p">);</span>
        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">VesselSegment</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_segment_2</span> <span class="o">=</span> <span class="n">VesselSegment</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;::</span><span class="n">Create</span><span class="p">(</span><span class="n">p_node_2</span><span class="p">,</span> <span class="n">p_node_3</span><span class="p">);</span>
        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Vessel</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_vessel_2</span> <span class="o">=</span> <span class="n">Vessel</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;::</span><span class="n">Create</span><span class="p">(</span><span class="n">p_segment_2</span><span class="p">);</span>
        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">VesselSegment</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_segment_3</span> <span class="o">=</span> <span class="n">VesselSegment</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;::</span><span class="n">Create</span><span class="p">(</span><span class="n">p_node_2</span><span class="p">,</span> <span class="n">p_node_4</span><span class="p">);</span>
        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Vessel</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_vessel_3</span> <span class="o">=</span> <span class="n">Vessel</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;::</span><span class="n">Create</span><span class="p">(</span><span class="n">p_segment_3</span><span class="p">);</span>
        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">VesselNetwork</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_network</span> <span class="o">=</span> <span class="n">VesselNetwork</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;::</span><span class="n">Create</span><span class="p">();</span>
        <span class="n">p_network</span><span class="o">-&gt;</span><span class="n">AddVessel</span><span class="p">(</span><span class="n">p_vessel_1</span><span class="p">);</span>
        <span class="n">p_network</span><span class="o">-&gt;</span><span class="n">AddVessel</span><span class="p">(</span><span class="n">p_vessel_2</span><span class="p">);</span>
        <span class="n">p_network</span><span class="o">-&gt;</span><span class="n">AddVessel</span><span class="p">(</span><span class="n">p_vessel_3</span><span class="p">);</span>
        <span class="n">TS_ASSERT_EQUALS</span><span class="p">(</span><span class="n">p_network</span><span class="o">-&gt;</span><span class="n">GetNumberOfNodes</span><span class="p">(),</span> <span class="mi">4u</span><span class="p">);</span>
        <span class="n">TS_ASSERT_EQUALS</span><span class="p">(</span><span class="n">p_network</span><span class="o">-&gt;</span><span class="n">GetNumberOfVessels</span><span class="p">(),</span> <span class="mi">3u</span><span class="p">);</span>
        <span class="n">MAKE_PTR_ARGS</span><span class="p">(</span><span class="n">OutputFileHandler</span><span class="p">,</span> <span class="n">p_handler</span><span class="p">,</span> <span class="p">(</span><span class="s">"TestBuildVesselNetworkLiteratePaper"</span><span class="p">));</span>
        <span class="n">VesselNetworkWriter</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="n">writer</span><span class="p">;</span>
        <span class="n">writer</span><span class="p">.</span><span class="n">SetFileName</span><span class="p">(</span><span class="n">p_handler</span><span class="o">-&gt;</span><span class="n">GetOutputDirectoryFullPath</span><span class="p">()</span> <span class="o">+</span> <span class="s">"bifurcating_network.vtp"</span><span class="p">);</span>
        <span class="n">writer</span><span class="p">.</span><span class="n">SetVesselNetwork</span><span class="p">(</span><span class="n">p_network</span><span class="p">);</span>
        <span class="n">writer</span><span class="p">.</span><span class="n">Write</span><span class="p">();</span>
        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">MicrovesselVtkScene</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_scene</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">MicrovesselVtkScene</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">MicrovesselVtkScene</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="p">);</span>
        <span class="n">p_scene</span><span class="o">-&gt;</span><span class="n">SetVesselNetwork</span><span class="p">(</span><span class="n">p_network</span><span class="p">);</span>
        <span class="n">p_scene</span><span class="o">-&gt;</span><span class="n">SetSaveAsImages</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
        <span class="n">p_scene</span><span class="o">-&gt;</span><span class="n">SetOutputFilePath</span><span class="p">(</span><span class="n">p_handler</span><span class="o">-&gt;</span><span class="n">GetOutputDirectoryFullPath</span><span class="p">()</span> <span class="o">+</span> <span class="s">"network"</span><span class="p">);</span>
        <span class="n">p_scene</span><span class="o">-&gt;</span><span class="n">Start</span><span class="p">();</span>
        <span class="n">BaseUnits</span><span class="o">::</span><span class="n">Instance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">Destroy</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">TestBuildNetworkFromGeneratorAndReadFromFile</span><span class="p">()</span> <span class="k">throw</span> <span class="p">(</span><span class="n">Exception</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">units</span><span class="o">::</span><span class="n">quantity</span><span class="o">&lt;</span><span class="n">unit</span><span class="o">::</span><span class="n">length</span><span class="o">&gt;</span> <span class="n">cell_width</span><span class="p">(</span><span class="mf">25.0</span> <span class="o">*</span> <span class="n">unit</span><span class="o">::</span><span class="n">microns</span><span class="p">);</span>
        <span class="n">BaseUnits</span><span class="o">::</span><span class="n">Instance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">SetReferenceLengthScale</span><span class="p">(</span><span class="n">cell_width</span><span class="p">);</span>
        <span class="n">BaseUnits</span><span class="o">::</span><span class="n">Instance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">SetReferenceTimeScale</span><span class="p">(</span><span class="mf">60.0</span> <span class="o">*</span> <span class="n">unit</span><span class="o">::</span><span class="n">seconds</span><span class="p">);</span>
        <span class="n">units</span><span class="o">::</span><span class="n">quantity</span><span class="o">&lt;</span><span class="n">unit</span><span class="o">::</span><span class="n">length</span><span class="o">&gt;</span> <span class="n">target_width</span> <span class="o">=</span> <span class="mf">60.0</span> <span class="o">*</span> <span class="n">cell_width</span><span class="p">;</span>
        <span class="n">units</span><span class="o">::</span><span class="n">quantity</span><span class="o">&lt;</span><span class="n">unit</span><span class="o">::</span><span class="n">length</span><span class="o">&gt;</span> <span class="n">target_height</span> <span class="o">=</span> <span class="mf">30.0</span> <span class="o">*</span> <span class="n">cell_width</span><span class="p">;</span>
        <span class="n">units</span><span class="o">::</span><span class="n">quantity</span><span class="o">&lt;</span><span class="n">unit</span><span class="o">::</span><span class="n">length</span><span class="o">&gt;</span> <span class="n">vessel_length</span> <span class="o">=</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">cell_width</span><span class="p">;</span>
        <span class="n">VesselNetworkGenerator</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span> <span class="n">network_generator</span><span class="p">;</span>
        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">VesselNetwork</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_network</span> <span class="o">=</span> <span class="n">network_generator</span><span class="p">.</span><span class="n">GenerateHexagonalNetwork</span><span class="p">(</span><span class="n">target_width</span><span class="p">,</span>
                                                                                                    <span class="n">target_height</span><span class="p">,</span>
                                                                                                    <span class="n">vessel_length</span><span class="p">);</span>
        <span class="kt">unsigned</span> <span class="n">number_of_nodes</span> <span class="o">=</span> <span class="n">p_network</span><span class="o">-&gt;</span><span class="n">GetNumberOfNodes</span><span class="p">();</span>
        <span class="kt">unsigned</span> <span class="n">number_of_vessels</span> <span class="o">=</span> <span class="n">p_network</span><span class="o">-&gt;</span><span class="n">GetNumberOfVessels</span><span class="p">();</span>
        <span class="n">MAKE_PTR_ARGS</span><span class="p">(</span><span class="n">OutputFileHandler</span><span class="p">,</span> <span class="n">p_handler</span><span class="p">,</span> <span class="p">(</span><span class="s">"TestBuildVesselNetworkLiteratePaper"</span><span class="p">,</span> <span class="nb">false</span><span class="p">));</span>
        <span class="n">VesselNetworkWriter</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span> <span class="n">writer</span><span class="p">;</span>
        <span class="n">writer</span><span class="p">.</span><span class="n">SetFileName</span><span class="p">(</span><span class="n">p_handler</span><span class="o">-&gt;</span><span class="n">GetOutputDirectoryFullPath</span><span class="p">()</span> <span class="o">+</span> <span class="s">"hexagonal_network.vtp"</span><span class="p">);</span>
        <span class="n">writer</span><span class="p">.</span><span class="n">SetVesselNetwork</span><span class="p">(</span><span class="n">p_network</span><span class="p">);</span>
        <span class="n">units</span><span class="o">::</span><span class="n">quantity</span><span class="o">&lt;</span><span class="n">unit</span><span class="o">::</span><span class="n">length</span><span class="o">&gt;</span> <span class="n">micron_length_scale</span><span class="p">(</span><span class="mf">1.0</span><span class="o">*</span><span class="n">unit</span><span class="o">::</span><span class="n">microns</span><span class="p">);</span>
        <span class="n">writer</span><span class="p">.</span><span class="n">SetReferenceLengthScale</span><span class="p">(</span><span class="n">micron_length_scale</span><span class="p">);</span>
        <span class="n">writer</span><span class="p">.</span><span class="n">Write</span><span class="p">();</span>
        <span class="n">VesselNetworkReader</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span> <span class="n">network_reader</span><span class="p">;</span>
        <span class="n">network_reader</span><span class="p">.</span><span class="n">SetReferenceLengthScale</span><span class="p">(</span><span class="n">micron_length_scale</span><span class="p">);</span>
        <span class="n">network_reader</span><span class="p">.</span><span class="n">SetFileName</span><span class="p">(</span><span class="n">p_handler</span><span class="o">-&gt;</span><span class="n">GetOutputDirectoryFullPath</span><span class="p">()</span> <span class="o">+</span> <span class="s">"hexagonal_network.vtp"</span><span class="p">);</span>
        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">VesselNetwork</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_network_from_file</span> <span class="o">=</span> <span class="n">network_reader</span><span class="p">.</span><span class="n">Read</span><span class="p">();</span>
        <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">MicrovesselVtkScene</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">p_scene</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">MicrovesselVtkScene</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span> <span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">MicrovesselVtkScene</span><span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span><span class="p">);</span>
        <span class="n">p_scene</span><span class="o">-&gt;</span><span class="n">SetVesselNetwork</span><span class="p">(</span><span class="n">p_network_from_file</span><span class="p">);</span>
        <span class="n">p_scene</span><span class="o">-&gt;</span><span class="n">SetSaveAsImages</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
        <span class="n">p_scene</span><span class="o">-&gt;</span><span class="n">SetOutputFilePath</span><span class="p">(</span><span class="n">p_handler</span><span class="o">-&gt;</span><span class="n">GetOutputDirectoryFullPath</span><span class="p">()</span> <span class="o">+</span> <span class="s">"hexagonal_network"</span><span class="p">);</span>
        <span class="n">p_scene</span><span class="o">-&gt;</span><span class="n">Start</span><span class="p">();</span>
        <span class="n">TS_ASSERT_EQUALS</span><span class="p">(</span><span class="n">p_network_from_file</span><span class="o">-&gt;</span><span class="n">GetNumberOfNodes</span><span class="p">(),</span> <span class="n">number_of_nodes</span><span class="p">);</span>
        <span class="n">TS_ASSERT_EQUALS</span><span class="p">(</span><span class="n">p_network_from_file</span><span class="o">-&gt;</span><span class="n">GetNumberOfVessels</span><span class="p">(),</span> <span class="n">number_of_vessels</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
          </div>
      </div>
    </div>
  </div>
</div>


  <div class="footer">
  <div class="container">
    <ul>
      <li><h5>Documentation</h5></li>
      <li><a href="https://jmsgrogan.github.io/MicrovesselChaste/documentation/getting-started.html">Getting Started</a></li>
      <li><a href="https://jmsgrogan.github.io/MicrovesselChaste/documentation/python-api/index.html">Python API</a></li>
      <li><a href="https://jmsgrogan.github.io/MicrovesselChaste/documentation/cpp-api/index.html">C++ API</a></li>
      <li><a href="https://jmsgrogan.github.io/MicrovesselChaste/documentation/tutorials.html">Tutorials</a></li>
    </ul>
    <ul>
      <li><h5>Download</h5></li>
        <li><a href="https://jmsgrogan.github.io/MicrovesselChaste/documentation/installation.html">Instructions</a></li>
    </ul>
    <ul>
      <li><h5>Community</h5></li>
      <li><a href="https://jmsgrogan.github.io/MicrovesselChaste/community/">Community</a></li>
      <li><a href="https://jmsgrogan.github.io/MicrovesselChaste/community/index.html#mailing-lists">Mailing Lists</a></li>
    </ul>
    <ul>
      <li><h5>Contribute</h5></li>
      <li><a href="https://jmsgrogan.github.io/MicrovesselChaste/contribute">How to Help</a></li>
      <li><a href="https://jmsgrogan.github.io/MicrovesselChaste/contribute/">Report an Issue</a></li>
    </ul>
    </div>
    <div class="container">
      <div class="copyright">
        <p style="float: left;"><br/>Copyright &copy; 2015-<span class="current-year"></span> University of Oxford<br/> Oxford, United Kingdom. Released under <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 Unported License</a>.<br />
Source code for this website was modified from the <a href="https://www.scala-lang.org/">scala website</a> on <a href="https://www.scala-lang.org/">github</a>. <br />
See <a href="https://raw.github.com/scala/scala-lang/master/license.md">original license</a> for details. </p>
      </div>
      <div class="scala-logo-footer">
        <img src="https://jmsgrogan.github.io/MicrovesselChaste/resources/img/mvc_logo_25.png" alt="Microvessel Chaste Logo" />
      </div>
    </div> <!-- container -->
    </div> <!-- footer -->

    <!-- prettify  js -->
    <script src="https://jmsgrogan.github.io/MicrovesselChaste/resources/js/vendor/prettify/prettify.js" type="text/javascript" ></script>
    <script src="https://jmsgrogan.github.io/MicrovesselChaste/resources/js/vendor/prettify/lang-scala.js" type="text/javascript" ></script>

    <!-- jquery js -->
    <script src="https://jmsgrogan.github.io/MicrovesselChaste/resources/js/vendor/jquery-1.8.3.min.js" type="text/javascript" ></script>
    <script src="https://jmsgrogan.github.io/MicrovesselChaste/resources/js/vendor/jquery.stellar.min.js" type="text/javascript" ></script>
    <script src="https://jmsgrogan.github.io/MicrovesselChaste/resources/js/vendor/tweetMachine.min.js" type="text/javascript" ></script>

    <!-- modernizr js -->
    <script src="https://jmsgrogan.github.io/MicrovesselChaste/resources/js/vendor/modernizr-2.6.2-respond-1.1.0.min.js" type="text/javascript" ></script>

    <!-- retina js -->
    <script src="https://jmsgrogan.github.io/MicrovesselChaste/resources/js/vendor/retina.js" type="text/javascript" ></script>

    <!-- backstretch js -->
    <script src="https://jmsgrogan.github.io/MicrovesselChaste/resources/js/vendor/jquery.backstretch.min.js" type="text/javascript" ></script>

    <!-- Bootstrap JS -->
    <script src="https://jmsgrogan.github.io/MicrovesselChaste/resources/js/vendor/bootstrap.min.js" type="text/javascript" ></script>

    
    <!-- table of contents JS -->
    <script src="https://jmsgrogan.github.io/MicrovesselChaste/resources/js/vendor/toc.js" type="text/javascript" ></script>
    <script type="text/javascript">
      $(document).ready(function(){
        $('#toc').toc({exclude: 'h1, h5, h6', context: '', autoId: true, numerate: false});
        function moveScroller() {
          if ($(".sidebar").length == 0)
            return;
          var a = function() {
            var topOfScroll = $(window).scrollTop();
            var topOfSidebar = $(".sidebar").offset().top;
            var sidebarInner = $(".sidebar-inner");
            var bottomOfSidebarInner = $(".sidebar-inner").offset().top + $(".sidebar-inner").outerHeight();
            var topOfFooter = $(".footer").offset().top - 10;
            var footerHeight = $(".footer").outerHeight();
            if (topOfScroll > topOfSidebar) {
              if (bottomOfSidebarInner > topOfFooter) {
                sidebarInner.css({position:"fixed",bottom:footerHeight,top:""});
              } else {
                sidebarInner.css({position:"fixed",top:"10px",bottom:""});
              }
            } else {
              sidebarInner.css({position:"relative",top:""});
            }
          };
          $(window).scroll(a);a()
        }
        moveScroller();
      })
    </script>
    

    <!-- Custom javascript -->
    <script src="https://jmsgrogan.github.io/MicrovesselChaste/resources/js/main.js" type="text/javascript"></script>
  </body>
</html>

